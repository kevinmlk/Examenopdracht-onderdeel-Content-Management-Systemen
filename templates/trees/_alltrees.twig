{% extends '_layout.twig' %}
{% block content %}

  {# Breadcrumbs navigation #}
  <nav style="--bs-breadcrumb-divider: url(&#34;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='%236c757d'/%3E%3C/svg%3E&#34;);" class="container mt-5 mb-5">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{{ siteUrl }}">Home</a></li>
      <li class="breadcrumb-item active" aria-current="page">Trees</li>
    </ol>
  </nav>
  {# Trees section #}
  <section class="container mt-5 mb-5 pt-5 pb-5">
    {% set homeSliderSection = craft.entries().section('homeSliderSection').one %}
    <h3>{{ homeSliderSection.sectionHeader }}</h3>
    {# Native area filter #}
    {% set filterItems = craft.entries().section('storeAreas').all() %}
    <div class='filter-items'>
    {% for item in filterItems %}
    <label><input type='checkbox' name='{{item}}'/>{{item}}</label>
    {% endfor %}
    </div>
    {# Trees gallery #}
    <div class="trees-container row row-cols-1 row-cols-md-3 g-4 mt-5">
      {% set treesEntries = craft.entries().section('treesArticles').all() %}
      {% for treesEntry in treesEntries %}
      <div class="col d-flex">
        <div class="card"
        {% for nativeAreaFilter in treesEntry.storeAreas %}
        data-{{nativeAreaFilter}}
        {% endfor %} 
        >
          <img src="{{ treesEntry.treeThumbnail.one().url('treeMediumThumbnail') }}" class="card-img-top" alt="{{ treesEntry.title }}">
          <div class="card-body">
            <h5 class="card-title">{{ treesEntry.title }}</h5>
            <p class="card-text">{{ treesEntry.treeIntroText }}</p>
          </div>
          <ul class="list-group list-group-flush">
            <li class="list-group-item">Botanical name: {{ treesEntry.botanicalName }}</li>
            <li class="list-group-item">Native area: {{ treesEntry.nativeAreas.label }}</li>
            <li class="list-group-item">Plant family: {{ treesEntry.plantFamily }}</li>
          </ul>
          <div class="card-body">
            <a href="{{ treesEntry.Url }}" class="card-link">More</a>
            <a href="{{ treesEntry.treeLink }}" target="_blank" class="card-link">Shop</a>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </section>

  <script>
    let selectedAreas = [];
    document.querySelectorAll(".filter-items input").forEach((element) => {
      element.addEventListener("change", onSelectArea);
    });

    function onSelectArea(e) {
      console.log("change");
      if (selectedAreas.includes(this.name)) {
        let index = selectedAreas.indexOf(this.name);
        selectedAreas.splice(index, 1);
      }
      else {
        selectedAreas.push(this.name);
      }
      console.log(selectedAreas);
      updateGrid();
    }

    function updateGrid() {
      console.log("updateGrid");
      document.querySelectorAll(".trees-container .card").forEach((el) => {
        el.style.display = "none";
        // console.log(selectedAreas);
        for (let i = 0; i < selectedAreas.length; i++) {
          // console.log(el.hasAttribute("data-" + selectedAreas[i]));
          if (el.hasAttribute("data-" + selectedAreas[i])) {
            el.style.display = "block";
          }
        }
        if (selectedAreas.length == 0) {
          el.style.display = "block";
        }
      });
    }
  </script>

{% endblock %}